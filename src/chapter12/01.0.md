#### linux网络模型

开放系统互连参考模型 (Open System Interconnect 简称OSI）是国际标准化组织(ISO)和国际电报电话咨询委员会(CCITT)联合制定的开放系统互连参考模型，为开放式互连信息系统提供了一种功能结构的框架。它从低到高分别是：物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。

OSI参考模型的全称是开放系统互连参考模型，是由国际标准化组织ISO在20世纪80年代初提出来的。ISO自从1946年成立以来，已经提出了多个标准，而ISO/IEC 7498，这个关于网络体系结构的标准定义了网络互连的基本参考模型。当时，网络界出现了以IBM的SNA为代表的若干个网络体系结构，这些体系结构的着眼点往往是各公司内部的网络连接，没有统一的标准，因而它们之间很难互连起来。在这种情况下，ISO提出了OSI参考模型，它最大的特点是开放性。不同厂家的网络产品，只要遵照这个参考模型，就可以实现互连、互操作和可移植性。也就是说，任何遵循OSI标准的系统，只要物理上连接起来，它们之间都可以互相通信。

OSI参考模型定义了开放系统的层次结构和各层所提供的服务。OSI参考模型的一个成功之处在于，它清晰地分开了服务、接口和协议这3个容易混淆的概念。服务描述了每一层的功能，接口定义了某层提供的服务如何被高层访问，而协议是每一层功能的实现方法。通过区分这些抽象概念，OSI参考模型将功能定义与实现细节区分开来，概括性高，使它具有普遍的适应能力。

OSI参考模型是具有7个层次的框架，自底向上的7个层次分别是物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。

对于linux网络模型,OSI 模型还是太复杂了，也没提供一个可实现的方法。因此在 Linux 中，实际上使用的是另一个更实用的四层模型，即 TCP/IP 网络模型。 TCP/IP 模型，把网络互联的框架分为应用层、传输层、网络层、网络接口层等四层.

* 应用层，负责向用户提供一组应用程序，比如 HTTP、FTP、DNS 等。
* 传输层，负责端到端的通信，比如 TCP、UDP 等。
* 网络层，负责网络包的封装、寻址和路由，比如 IP、ICMP 等。
* 网络接口层，负责网络包在物理网络中的传输，比如 MAC 寻址、错误侦测以及通过网卡传输网络帧等。

Linux 实际按照 TCP/IP 模型，实现了网络协议栈，通常我们还是习惯用 OSI 七层模型来描述。比如，说到七层和四层负载均衡，对应的分别是 OSI 模型中的应用层和传输层（而它们对应到 TCP/IP 模型中，实际上是四层和三层）。


<p align="center">
<img width="300" align="center" src="../images/20.jpg" />
</p>

传输层在应用程序数据前面增加了 TCP 头；
网络层在 TCP 数据包前增加了 IP 头；
而网络接口层，又在 IP 数据包前后分别增加了帧头和帧尾。

接着我们可以看下,Linux 内核中的网络栈.

<p align="center">
<img width="500" align="center" src="../images/21.jpg" />
</p>

* 最上面的的应用程序，需要通过系统调用，来跟套接字接口进行交互；
* 套接字的下面，就是我们前面提到的传输层、网络层和网络接口层；
* 最底层，则是网卡驱动程序以及物理网卡设备。

网卡是发送和接收网络包的基本设备。在系统启动过程中，网卡通过内核中的网卡驱动程序注册到系统中。而在网络收发过程中，内核通过中断跟网卡进行交互。再结合前面提到的 Linux 网络栈，可以看出，网络包的处理非常复杂。所以，网卡硬中断只处理最核心的网卡数据读取或发送，而协议栈中的大部分逻辑，都会放到软中断中处理。

网络包如何接受?

当一个网络帧到达网卡后，网卡会通过 DMA 方式，把这个网络包放到收包队列中；然后通过硬中断，告诉中断处理程序已经收到了网络包。接着，网卡中断处理程序会为网络帧分配内核数据结构（sk_buff），并将其拷贝到 sk_buff 缓冲区中；然后再通过软中断，通知内核收到了新的网络帧。

<p align="center">
<img width="500" align="center" src="../images/22.jpg" />
</p>
